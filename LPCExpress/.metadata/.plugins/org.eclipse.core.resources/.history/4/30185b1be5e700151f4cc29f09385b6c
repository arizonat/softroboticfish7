/*
 * JoystickController.h
 *
 * Author: Joseph DelPreto
 */

#ifndef SERIALCONTROL_SERIALCONTROLLER_H_
#define SERIALCONTROL_SERIALCONTROLLER_H_

#include "FishController.h"
#include "mbed.h"

#define defaultBaudUSB 115200
#define defaultBaud 115200
#define defaultTX p2
#define defaultRX p1
// note lowBatteryVoltagePin is defined in FishController

#define printStatus // whether to print what's going on (i.e. when it gets commands, etc.)

#define runTime 10000 	   // how long to run for (in milliseconds) if inifiniteLoopSerial is undefined
#define infiniteLoopSerial // if defined, will run forever (or until stop() is called from another thread)

#define serialControllerControlFish // whether to start fishController to control the servos and motor

class SerialController
{
public:
	// Initialization
	SerialController(Serial* serialObject = NULL, Serial* usbSerialObject = NULL); // if objects are null, ones will be created
	void init(Serial* serialObject = NULL, Serial* usbSerialObject = NULL); // if serial objects are null, ones will be created
	// Execution control
	void run();
	void stop();
private:
	Timer programTimer;
	bool terminated;
	Serial* usbSerial;
	Serial* serial;

	// Low battery monitor
	DigitalIn* lowBatteryVoltageInput;
	void lowBatteryCallback();
};

// Create a static instance of SerialController to be used by anyone doing serial control
extern SerialController serialController;

#endif /* SERIALCONTROL_SERIALCONTROLLER_H_ */

